version: '3.8'

services:
  openclaw-dingtalk-bridge:
    image: node:20-alpine
    container_name: openclaw-dingtalk-bridge
    working_dir: /app
    command: node index.js
    environment:
      - PORT=3000
      # 钉钉机器人 WebHook URL（用于发送消息回钉钉）
      - DINGTALK_WEBHOOK_URL=${DINGTALK_WEBHOOK_URL}
      # 钉钉签名密钥（安全模式）
      - DINGTALK_SIGN_KEY=${DINGTALK_SIGN_KEY}
      # 钉钉关键字验证
      - DINGTALK_KEYWORD=OpenClaw
      # OpenClaw CLI 路径
      - OPENCLAW_PATH=openclaw
    volumes:
      - ./:/app
    ports:
      - "3000:3000"
    restart: unless-stopped
    depends_on:
      - openclaw-gateway

  # OpenClaw Gateway（如果需要）
  openclaw-gateway:
    image: ${CLAWDBOT_IMAGE:-openclaw:local}
    container_name: openclaw-gateway
    environment:
      HOME: /home/node
      TERM: xterm-256color
      CLAWDBOT_GATEWAY_TOKEN: ${CLAWDBOT_GATEWAY_TOKEN}
    volumes:
      - ${CLAWDBOT_CONFIG_DIR:-~/.openclaw}:/home/node/.openclaw
      - ${CLAWDBOT_CONFIG_DIR:-~/.openclaw}/.npmrc:/home/node/.npmrc:ro
      - ${CLAWDBOT_WORKSPACE_DIR:-./workspace}:/home/node/clawd
    ports:
      - "18789:18789"
      - "18790:18790"
    init: true
    restart: unless-stopped
